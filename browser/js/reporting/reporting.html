<div id = "wrapper" class = "view-height-main reportingpage">
	<div class = "wrapper wrapper-content animated fadeIn pad-tp-0">
		<div class = "p-w-md">
			<div class="row text-center">
			<div class="toggle6 col-md-12 clearfix">
        		<div class="col-lg-6 col-centereddiv mar-bt-30">
        			<div class = "row-centered outline-box pad-25">
										<div class="col-lg-12 no-pad col-centered">
											<ul class="tab clearfix">
												  <li><a class="btn btn-tab active" ng-click="openBrowse(event, 'attributeImpact')">Attribute Impact<br><span class="arrow-down"></span></a></li>
												  <li><a class="btn btn-tab" ng-click="openBrowse(event, 'tableImpact')">Table Impact<br><span class="arrow-down"></span></a></li>
												  <li><a class="btn btn-tab" ng-click="openBrowse(event, 'allMappings')">Total Mapping<br><span class="arrow-down"></span></a></li>
												</ul>
											<div id="attributeImpact" class="tabcontent">
											    <form method="post">
											    <h4 class="mr-top-25">Analyse the impact of an attribute</h4>
											        <fieldset class="tabFieldset m-t">
											        	
											            <input id="searchBar" ng-model="searchQuery" type="text" placeholder="Search" class="ng-pristine ng-untouched ng-valid ng-empty"/>
											            <input class="search-subm" type="submit" value="Submit" id="submitButton" ng-click="attributeSearch(searchQuery)"/>
											        </fieldset>
											    </form>
										    </div>
								    		<div id="tableImpact" class="tabcontent">
											    <form method="post">
											    <h4 class="mr-top-25">View Tables and Their Impact</h4>
											        <fieldset class="tabFieldset m-t">
														<div class = "row">
															<div class="col-md-12 ">
														        <div class="input-group m-b adnc-search">
														        	<ui-select ng-model="selectedSystem.value">
																	    <ui-select-match placeholder="Select a System">
																	        {{$select.selected.system_name}}
																	    </ui-select-match>
																	    <ui-select-choices repeat="system in (systems | filter: $select.search) track by system.system_id">
																	        <span ng-bind="system.system_name"></span>
																	    </ui-select-choices>
																	</ui-select>
														        </div>
												      		</div>
															<div class="col-md-12 ">
														        <div class="input-group m-b adnc-search">
														       			<ui-select ng-model="selectedDb.value">
																    <ui-select-match placeholder="Select a Database">
																        {{$select.selected.db_name}}
																    </ui-select-match>
																    <ui-select-choices repeat="db in (dbs | filter: $select.search) track by db.db_id">
																        <span ng-bind="db.db_name"></span>
																    </ui-select-choices>
																</ui-select>
														        </div>
												      		</div>

															<div class="col-md-12 ">
														        <div class="input-group m-b adnc-search">
																	<ui-select ng-model="selectedSchema.value">
																	    <ui-select-match placeholder="Select a Schema">
																	        {{$select.selected.schema_name}}
																	    </ui-select-match>
																	    <ui-select-choices repeat="schema in (schemas | filter: $select.search) track by schema.schema_id">
																	        <span ng-bind="schema.schema_name"></span>
																	    </ui-select-choices>
																	</ui-select>
														        </div>
												      		</div>
															
															<div class="col-md-12 ">
														        <div class="input-group m-b adnc-search">
																	<ui-select ng-model="selectedTable.value">
																	    <ui-select-match placeholder="Select a Table">
																	        {{$select.selected.table_name}}
																	    </ui-select-match>
																	    <ui-select-choices repeat="table in (tables | filter: $select.search) track by table.table_id">
																	        <span ng-bind="table.table_name"></span>
																	    </ui-select-choices>
																	</ui-select>
																</div>
															</div>	
														</div>
														<button class = "btn btn-blue action" ng-click = "tableImpact(selectedTable.value)">Find Impact</button>
											        </fieldset>
										    	</form>
									    	</div>
									    	<div id="allMappings" class="tabcontent">
											    <form method="post">
											    	<h4 class="mr-top-25">View all mappings and history</h4>
											        <fieldset class="tabFieldset m-t">
											        	<h4 ng-show="error">{{error}}</h4>
														<div class = "row">
															<div class="col-md-12 ">
														        <div class="input-group m-b adnc-search">
														        	<ui-select ng-model="selectedSystem.value">
																	    <ui-select-match placeholder="Select a System">
																	        {{$select.selected.system_name}}
																	    </ui-select-match>
																	    <ui-select-choices repeat="system in (systems | filter: $select.search) track by system.system_id">
																	        <span ng-bind="system.system_name"></span>
																	    </ui-select-choices>
																	</ui-select>
														        </div>
												      		</div>

															<div class="col-md-12 ">
														        <div class="input-group m-b adnc-search">
														       			<ui-select ng-model="selectedDb.value">
																    <ui-select-match placeholder="Select a Database">
																        {{$select.selected.db_name}}
																    </ui-select-match>
																    <ui-select-choices repeat="db in (dbs | filter: $select.search) track by db.db_id">
																        <span ng-bind="db.db_name"></span>
																    </ui-select-choices>
																</ui-select>
														        </div>
												      		</div>

															<div class="col-md-12 ">
														        <div class="input-group m-b adnc-search">
																	<ui-select ng-model="selectedSchema.value">
																	    <ui-select-match placeholder="Select a Schema">
																	        {{$select.selected.schema_name}}
																	    </ui-select-match>
																	    <ui-select-choices repeat="schema in (schemas | filter: $select.search) track by schema.schema_id">
																	        <span ng-bind="schema.schema_name"></span>
																	    </ui-select-choices>
																	</ui-select>
														        </div>
												      		</div>
															
															<div class="col-md-12 ">
														        <div class="input-group m-b adnc-search">
																	<ui-select ng-model="selectedTable.value">
																	    <ui-select-match placeholder="Select a Table">
																	        {{$select.selected.table_name}}
																	    </ui-select-match>
																	    <ui-select-choices repeat="table in (tables | filter: $select.search) track by table.table_id">
																	        <span ng-bind="table.table_name"></span>
																	    </ui-select-choices>
																	</ui-select>
																</div>
															</div>	
														</div>
														<button class = "btn btn-blue action" ng-click = "totalMappings(selectedTable.value)">Find Mappings</button>
											        </fieldset>
										    	</form>
										    </div>
										</div>
									</div>
       			</div>
       			<div class="col-lg-6 pull-right percent-100" ng-if="sources">
	       			<div class="row percent-50">	
						<div class = "ibox" style="height:100%; padding-left:15px; padding-right:15px;">
							<div class="attr-details">
		                        <div class="mail-tools tooltip-demo attribute-tab-head outline-box no-bt-brder">
		                            <div class="sect-att-head clearfix">
		                                <div class="lt-att-info">Sources</div>
		                            </div>
		                        </div>
		                    </div>
							<div class = "ibox-content outline-box">
								<div class="mail-body-table">
									<table class = "footable table table-striped toggle-arrow-tiny" data-page-size="8">
										<thead>
										<tr>
											<th data-toggle="true">Attribute Id</th>
											<th>Attribute Name</th>
											<th>Database</th>
											<th>Schema</th>
											<th>Table</th>
											<th data-hide="all">Datatype</th>
											<th data-hide="all">Last Modified</th>
											<th data-hide="all">Last Editor</th>
											<th data-hide="all">Impact Analysis</th>
										</tr>
										</thead>
										<tbody>
										<tr ng-repeat = "source in sources track by $index" foo-repeat-done>
											<td>{{source.attr_id}}</td>
											<td>{{source.attr_name}}</td>
											<td>{{source.db_name}}</td>
											<td>{{source.schema_name}}</td>
											<td>{{source.table_name}}</td>
											<td>{{source.datatype}}</td>
											<td>{{source.last_modified}}</td>
											<td>Last Editor</td>
											<td><button class = "btn btn-primary" ng-click="impact(source.attr_id)">Get Analysis</button></td>
										</tr>
										</tbody>
										<tfoot>
					                        <tr>
					                            <td colspan="5">
					                                <ul class="pagination"></ul>
					                            </td>
					                        </tr>
					                    </tfoot>			                    
									</table>
								</div>
							</div>	
						</div>
					</div>

					<div class="row percent-50" ng-if="targets">
						<div class = "ibox" style="height:100%; padding-left:15px; padding-right:15px;">
							<div class = "ibox-content" style="height:95%;">
								<div class="mail-box-header" style="background-color:#1ab394; padding: 15px 20px 15px 20px;">
									<button class="btn btn-primary"  ng-if="impactSearches !== []" ng-click = "previousImpact()" style="background-color:none; border-color:white; margin-right: 8px;"><i class="fa fa-arrow-left" style="" aria-hidden="true"></i></button>
									<h3 style="display:inline; padding-top:5px; color:white;">Targets</h3>
								</div>
								<div class="mail-body" style="border-left: 1px grey; border-right: 2px grey; overflow-y:scroll; max-height:85%;">
									<table class = "footable table table-striped toggle-arrow-tiny" data-page-size="8">
										<thead>
										<tr>
											<th data-toggle="true">Attribute Id</th>
											<th>Attribute Name</th>
											<th>Database</th>
											<th>Schema</th>
											<th>Table</th>
											<th data-hide="all">Datatype</th>
											<th data-hide="all">Last Modified</th>
											<th data-hide="all">Impact Analysis</th>
										</tr>
										</thead>
										<tbody>
										<tr ng-repeat = "target in targets track by $index" foo-repeat-done>
											<td>{{target.attr_id}}</td>
											<td>{{target.attr_name}}</td>
											<td>{{target.db_name}}</td>
											<td>{{target.schema_name}}</td>
											<td>{{target.table_name}}</td>
											<td>{{target.datatype}}</td>
											<td>{{target.last_modified}}</td>
											<td><button class = "btn btn-primary" ng-click="nextImpact(target.attr_id)">Get Analysis</button></td>
										</tr>
										</tbody>
										<tfoot>
					                        <tr>
					                            <td colspan="5">
					                                <ul class="pagination"></ul>
					                            </td>
					                        </tr>
					                    </tfoot>
									</table>
								</div>
							</div>	
						</div>
						<div ng-show="!targets && sources">
	                		<div class="col-lg-12">
		                   		<div class="ibox">
		                        	<div class="ibox-content" style="border-top:none;">
					             		<h2 style="text-align:center; font-weight:500; padding-bottom:17.5vh; padding-top:18vh;"> Selected attribute does not have any targets</h2>
		                         	</div>
		                        </div>
		                    </div>
                		</div>
					</div>
				</div>
				<div ng-if="allMapping" class="row percent-100 col-lg-6 pull-right">
					<div class = "ibox">
						<div class = "ibox-content">
							<div class="mail-box-header" style="background-color:#1c84c6; padding: 20px 20px 10px 20px;position:relative;">
									<h3 style="color:white;">All Current Mappings for {{selectedTable.value.table_name}}</h3>
									<button class="btn btn-primary btn-sm top-right-button" ng-click="getXls(recentMapping)"><i class="fa fa-download"></i>Excel</button>
									<button class = "btn btn-primary" ng-click = "transition()">Go to Detailed View</button>
							</div>
							<div class = "mail-body" style="border-left:1px grey; border-right: 2px grey;">
								<table class = "footable table table-striped toggle-arrow-tiny" data-page-size="8">
									<thead>
									<tr>
										<th data-toggle="true">Target Attribute</th>
										<th>Target Datatype</th>
										<th>Source Attribute</th>	
										<th>Sources Datatype</th>
										<th data-hide="all">Source Address</th>
                                        <th data-hide="all">Last Modifier</th>
                                        <th data-hide="all">Last Modified</th>
                                        <th>Select</th>
									</tr>
									</thead>
									<tbody>
									<tr ng-repeat = "mapping in recentMapping track by $index" foo-repeat-done>
										<td>{{mapping.target_attr_name}}</td>
										<td>{{mapping.target_datatype}}</td>
										<td>{{mapping.source_attr_name}}</td>
										<td>{{mapping.source_datatype}}</td>
										<td>{{mapping.source_system}}.{{mapping.source_db}}.{{mapping.source_schema}}.{{mapping.source_table}}</td>
										<td>{{mapping.modifier}}</td>
										<td>{{mapping.date_modified}}</td>
										<td><input type="checkbox" ng-model="selectedMappings[$index].selected"/></td>
									</tr>
									</tbody>
									<tfoot>
				                        <tr>
				                            <td colspan="5">
				                                <ul class="pagination"></ul>
				                            </td>
				                        </tr>
				                    </tfoot>			                    
								</table>
							</div>
						</div>	
					</div>
					
				</div>
   			</div>
   			</div>
		</div>
	</div>
</div>
